(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{737:function(s,a,t){"use strict";t.r(a);var e=t(62),r=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"检测是否支持-kvm"}},[s._v("检测是否支持 KVM "),a("a",{staticClass:"header-anchor",attrs:{href:"#检测是否支持-kvm"}},[s._v("#")])]),s._v(" "),a("blockquote",[a("p",[s._v("KVM 是基于 x86 虚拟化扩展(Intel VT 或者 AMD-V) 技术的虚拟机软件，所以查看 CPU 是否支持 VT 技术，就可以判断是否支持KVM。")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/cpuinfo "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("egrep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'vmx|svm'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 结果中有vmx（Intel）或svm(AMD)字样，就说明CPU的支持")]),s._v("\n")])])]),a("blockquote",[a("p",[s._v("关闭SELinux")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 SELinux 状态")]),s._v("\ngetenforce\n\nsestatus\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时关闭")]),s._v("\nsetenforce "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 永久关闭")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 selinux 中的 SELinux=enforcing 修改为 SELinux=disabled")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/selinux/config\n")])])]),a("h2",{attrs:{id:"安装-kvm"}},[s._v("安装 KVM "),a("a",{staticClass:"header-anchor",attrs:{href:"#安装-kvm"}},[s._v("#")])]),s._v(" "),a("blockquote",[a("ul",[a("li",[a("code",[s._v("qemu-kvm")]),s._v(" 主要的KVM程序包")]),s._v(" "),a("li",[a("code",[s._v("python-virtinst")]),s._v(" 创建虚拟机所需要的命令行工具和程序库")]),s._v(" "),a("li",[a("code",[s._v("virt-manager")]),s._v(" GUI虚拟机管理工具")]),s._v(" "),a("li",[a("code",[s._v("virt-top")]),s._v(" 虚拟机统计命令")]),s._v(" "),a("li",[a("code",[s._v("virt-viewer")]),s._v(" GUI连接程序，连接到已配置好的虚拟机")]),s._v(" "),a("li",[a("code",[s._v("libvirt")]),s._v(" C语言工具包，提供libvirt服务")]),s._v(" "),a("li",[a("code",[s._v("libvirt-client")]),s._v(" 为虚拟客户机提供的C语言工具包")]),s._v(" "),a("li",[a("code",[s._v("virt-install")]),s._v(" 基于libvirt服务的虚拟机创建命令")]),s._v(" "),a("li",[a("code",[s._v("bridge-utils")]),s._v(" 创建和管理桥接设备的工具")])])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装")]),s._v("\nyum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" qemu-kvm python-virtinst libvirt libvirt-python virt-manager libguestfs-tools bridge-utils virt-install\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("reboot")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看")]),s._v("\nlsmod "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" kvm\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启 KVM 服务并设置开机启动")]),s._v("\nsystemctl start libvirtd\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" libvirtd\n")])])]),a("h2",{attrs:{id:"kvm-中安装虚拟机"}},[s._v("KVM 中安装虚拟机 "),a("a",{staticClass:"header-anchor",attrs:{href:"#kvm-中安装虚拟机"}},[s._v("#")])]),s._v(" "),a("blockquote",[a("p",[s._v("cd /etc/sysconfig/network-scripts/")])]),s._v(" "),a("h3",{attrs:{id:"宿主机网卡配置"}},[s._v("宿主机网卡配置 "),a("a",{staticClass:"header-anchor",attrs:{href:"#宿主机网卡配置"}},[s._v("#")])]),s._v(" "),a("h5",{attrs:{id:"配置网桥-ifcfg-bridge0"}},[s._v("配置网桥 ifcfg-bridge0 "),a("a",{staticClass:"header-anchor",attrs:{href:"#配置网桥-ifcfg-bridge0"}},[s._v("#")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TYPE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Bridge\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BOOTPROTO")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("static\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("IPADDR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.200\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PREFIX")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GATEWAY")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.1\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DNS1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.1\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bridge0\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DEVICE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bridge0\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ONBOOT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n")])])]),a("h5",{attrs:{id:"配置网卡-ifcfg-enp8s0"}},[s._v("配置网卡 ifcfg-enp8s0 "),a("a",{staticClass:"header-anchor",attrs:{href:"#配置网卡-ifcfg-enp8s0"}},[s._v("#")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TYPE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Ethernet\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BOOTPROTO")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("none\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BRIDGE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bridge0\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("enp8s0\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DEVICE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("enp8s0\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ONBOOT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n")])])]),a("h3",{attrs:{id:"重启网卡服务"}},[s._v("重启网卡服务 "),a("a",{staticClass:"header-anchor",attrs:{href:"#重启网卡服务"}},[s._v("#")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("systemctl restart network\n")])])]),a("h3",{attrs:{id:"安装centos7虚拟机"}},[s._v("安装centos7虚拟机 "),a("a",{staticClass:"header-anchor",attrs:{href:"#安装centos7虚拟机"}},[s._v("#")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("virt-install --virt-type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kvm "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("centos7-base "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--vcpus")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--memory")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--location")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/home/pnoker/Downloads/iso/CentOS-7-x86_64-Minimal-2009.iso "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--disk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("path")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/kvm/images/centos7-base.qcow2,size"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(",format"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("qcow2 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bridge")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bridge0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--graphics")]),s._v(" none --extra-args"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'console=ttyS0'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--force")]),s._v("\n")])])]),a("h3",{attrs:{id:"虚拟机网卡配置"}},[s._v("虚拟机网卡配置 "),a("a",{staticClass:"header-anchor",attrs:{href:"#虚拟机网卡配置"}},[s._v("#")])]),s._v(" "),a("h5",{attrs:{id:"配置网卡-ifcfg-ens3"}},[s._v("配置网卡 ifcfg-ens3 "),a("a",{staticClass:"header-anchor",attrs:{href:"#配置网卡-ifcfg-ens3"}},[s._v("#")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TYPE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Ethernet\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BOOTPROTO")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("static\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("IPADDR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.10\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PREFIX")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GATEWAY")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.1\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DNS1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.1\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DEFROUTE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PEERDNS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PEERROUTES")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("IPV4_FAILURE_FATAL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("no\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("IPV6INIT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("IPV6_AUTOCONF")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("IPV6_DEFROUTE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("IPV6_PEERROUTES")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("IPV6_FAILURE_FATAL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("no\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ens3\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("UUID")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("369be450-f9b3-468d-a66d-661944f9d7f4\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DEVICE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ens3\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ONBOOT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n")])])]),a("h3",{attrs:{id:"启动网卡"}},[s._v("启动网卡 "),a("a",{staticClass:"header-anchor",attrs:{href:"#启动网卡"}},[s._v("#")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifup")]),s._v(" ens3\n")])])]),a("h3",{attrs:{id:"常见指令"}},[s._v("常见指令 "),a("a",{staticClass:"header-anchor",attrs:{href:"#常见指令"}},[s._v("#")])]),s._v(" "),a("p",[s._v("KVM虚拟机的管理主要是通过virsh命令对虚拟机进行管理")]),s._v(" "),a("p",[s._v("帮助文档")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# virsh --help")]),s._v("\n")])])]),a("p",[s._v("查看虚拟机状态")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# virsh list --all")]),s._v("\n Id    名称                         状态\n----------------------------------------------------\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("     win2k8r2                       running\n")])])]),a("p",[s._v("关机")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# virsh shutdown win2k8r2")]),s._v("\n")])])]),a("p",[s._v("强制关闭电源")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# virsh destroy win2k8r2")]),s._v("\n")])])]),a("p",[s._v("通过配置文件创建虚拟机")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# virsh create /etc/libvirt/qemu/win2k8r2.xml")]),s._v("\n")])])]),a("p",[s._v("设置虚拟机开机自启")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# virsh autostart win2k8r2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll /etc/libvirt/qemu/autostart/")]),s._v("\n总用量 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nlrwxrwxrwx "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("月  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":06 win2k8r2.xml -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/libvirt/qemu/win2k8r2.xml\n")])])]),a("p",[s._v("到处虚拟机配置文件")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# virsh dumpxml win2k8r2 > /etc/libvirt/qemu/win2k8r2_bak.xml")]),s._v("\n")])])]),a("p",[s._v("删除虚拟机（该命令只删除配置文件，并不删除磁盘文件）")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# virsh undefine win2k8r2")]),s._v("\n")])])]),a("p",[s._v("通过导出备份的配置文件恢复原KVM虚拟机的定义，并重新定义虚拟机。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mv /etc/libvirt/qemu/win2k8r2_bak.xml /etc/libvirt/qemu/win2k8r2.xml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# virsh define /etc/libvirt/qemu/win2k8r2.xml")]),s._v("\n")])])]),a("p",[s._v("编辑配置文件")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# virsh edit win2k8r2")]),s._v("\n")])])]),a("p",[s._v("挂起")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# virsh suspend win2k8r2")]),s._v("\n")])])]),a("p",[s._v("恢复")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# virsh resume win2k8r2")]),s._v("\n")])])]),a("p",[s._v("创建存储卷")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# qemu-img create -f qcow2 /data/kvmstorage/centos7.qcow2 20G")]),s._v("\nFormatting "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/data/kvmstorage/centos7.qcow2'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("fmt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("qcow2 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("size")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21474836480")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("encryption")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("off "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cluster_size")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("lazy_refcounts")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("off \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll //data/kvmstorage")]),s._v("\n总用量 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7437168")]),s._v("\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("197120")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("月  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":21 centos7.qcow2\n-rw------- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" qemu qemu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42956488704")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("月  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":21 win2k8r2.qcow2\n")])])]),a("p",[s._v("生成虚拟机")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# virt-install --virt-type kvm --name centos --ram 1024 \\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--disk")]),s._v(" /data/kvmstorage/centos7.qcow2,format"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("qcow2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bridge")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("br0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--graphics")]),s._v(" vnc,listen"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--noautoconsole")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --os-type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("linux --os-variant"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("rhel7 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--location")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/iso/CentOS-7-x86_64-Minimal-1804.iso\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# virsh list --all")]),s._v("\n Id    名称                         状态\n----------------------------------------------------\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("     win2k8r2                       running\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("     centos                         running\n")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);