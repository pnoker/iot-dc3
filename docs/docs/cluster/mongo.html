<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
        />
        <title>Mongo é›†ç¾¤éƒ¨ç½² | IoT DC3</title>
        <meta name="description" content="" />
        <meta name="generator" content="VuePress 1.9.9" />
        <link rel="icon" href="/assets/images/favicon.ico">
    <script type="text/javascript" src="/assets/js/push.js"></script> <meta name="description" content="DC3æ˜¯ä¸€ä¸ªåŸºäºSpring Cloudçš„å¼€æºçš„ã€åˆ†å¸ƒå¼çš„ç‰©è”ç½‘(IOT)å¹³å°,ç”¨äºå¿«é€Ÿå¼€å‘ç‰©è”ç½‘é¡¹ç›®å’Œç®¡ç†ç‰©è”è®¾å¤‡,æ˜¯ä¸€æ•´å¥—ç‰©è”ç³»ç»Ÿè§£å†³æ–¹æ¡ˆã€‚">
    <meta name="referrer" content="never">
    <meta name="keywords" content="iot,dc3,DC3,iotdc3,iot dc3,IOTDC3,IoTDC3,IOT DC3,IoT DC3,ç‰©è”ç½‘,å¼€æº,åˆ†å¸ƒå¼,ç‰©è”ç½‘å¹³å°,IOTå¹³å°"> <link rel="preload" href="/assets/css/0.styles.116dcc83.css" as="style"><link rel="preload" href="/assets/js/app.d87ce824.js" as="script"><link rel="preload" href="/assets/js/2.a8b8915e.js" as="script"><link rel="preload" href="/assets/js/10.db658154.js" as="script"><link rel="prefetch" href="/assets/js/11.653957ce.js"><link rel="prefetch" href="/assets/js/12.08136beb.js"><link rel="prefetch" href="/assets/js/13.83b3d580.js"><link rel="prefetch" href="/assets/js/14.d5387cec.js"><link rel="prefetch" href="/assets/js/15.aafb2a89.js"><link rel="prefetch" href="/assets/js/16.01fcc650.js"><link rel="prefetch" href="/assets/js/17.a097fd52.js"><link rel="prefetch" href="/assets/js/18.acd93e71.js"><link rel="prefetch" href="/assets/js/19.6f12b224.js"><link rel="prefetch" href="/assets/js/20.bac69ff1.js"><link rel="prefetch" href="/assets/js/21.9105165e.js"><link rel="prefetch" href="/assets/js/22.de1f017c.js"><link rel="prefetch" href="/assets/js/23.fb20a8f5.js"><link rel="prefetch" href="/assets/js/24.63ca195a.js"><link rel="prefetch" href="/assets/js/25.3a76708d.js"><link rel="prefetch" href="/assets/js/26.b6254386.js"><link rel="prefetch" href="/assets/js/27.3f127a30.js"><link rel="prefetch" href="/assets/js/28.afadbe5c.js"><link rel="prefetch" href="/assets/js/29.f175dd67.js"><link rel="prefetch" href="/assets/js/3.8e04da2b.js"><link rel="prefetch" href="/assets/js/30.5ba7a495.js"><link rel="prefetch" href="/assets/js/31.01c3d218.js"><link rel="prefetch" href="/assets/js/32.de0e0ff7.js"><link rel="prefetch" href="/assets/js/33.0e117d4a.js"><link rel="prefetch" href="/assets/js/34.010094c5.js"><link rel="prefetch" href="/assets/js/35.8a377a71.js"><link rel="prefetch" href="/assets/js/36.fbb64a47.js"><link rel="prefetch" href="/assets/js/37.c2b9d4da.js"><link rel="prefetch" href="/assets/js/38.a66be625.js"><link rel="prefetch" href="/assets/js/39.76e387bc.js"><link rel="prefetch" href="/assets/js/4.470d098a.js"><link rel="prefetch" href="/assets/js/40.0e9ee726.js"><link rel="prefetch" href="/assets/js/41.e68f3c2e.js"><link rel="prefetch" href="/assets/js/42.ba03ba76.js"><link rel="prefetch" href="/assets/js/43.e6a91a35.js"><link rel="prefetch" href="/assets/js/44.128407ae.js"><link rel="prefetch" href="/assets/js/45.e9f1b4b0.js"><link rel="prefetch" href="/assets/js/46.ab599c67.js"><link rel="prefetch" href="/assets/js/47.dc2d8aff.js"><link rel="prefetch" href="/assets/js/48.06e9c64e.js"><link rel="prefetch" href="/assets/js/49.627cc127.js"><link rel="prefetch" href="/assets/js/5.0f4aedb8.js"><link rel="prefetch" href="/assets/js/50.bf665f72.js"><link rel="prefetch" href="/assets/js/51.08e5dea0.js"><link rel="prefetch" href="/assets/js/52.8e37a9c4.js"><link rel="prefetch" href="/assets/js/53.8c472224.js"><link rel="prefetch" href="/assets/js/54.bb582a52.js"><link rel="prefetch" href="/assets/js/55.640d9ecb.js"><link rel="prefetch" href="/assets/js/56.e2e2a21e.js"><link rel="prefetch" href="/assets/js/57.9b9b26a7.js"><link rel="prefetch" href="/assets/js/58.0d4a46c3.js"><link rel="prefetch" href="/assets/js/59.d1f11d32.js"><link rel="prefetch" href="/assets/js/6.547754b6.js"><link rel="prefetch" href="/assets/js/7.aea1a047.js"><link rel="prefetch" href="/assets/js/8.58207631.js"><link rel="prefetch" href="/assets/js/9.f09083f8.js"> <link rel="stylesheet" href="/assets/css/0.styles.116dcc83.css">
    </head>
    <body>
        <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="nav-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-6 ant-col-xl-5 ant-col-xxl-4"><a href="/" class="router-link-active home-link"><img src="/assets/images/logo.png" alt="IoT DC3" class="logo"> <span class="site-name">IoT DC3</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="nav-space-between ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-18 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/" class="router-link-active">
                    é¦–é¡µ
                </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/docs/" class="router-link-active">
                    æŒ‡å—
                </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/config/">
                    é…ç½®
                </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/faq/">
                    FAQ
                </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
                    ä»£ç ä»“åº“
                </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <ul class="extra-group"><!----> <!----></ul></nav></div></div> <!----></header> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/docs/" aria-current="page" title="ç®€ä»‹" class="sidebar-link">ç®€ä»‹</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>å¼€å‘æŒ‡å—</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/code/0-environment.html" title="æ³¨æ„äº‹é¡¹" class="sidebar-link">æ³¨æ„äº‹é¡¹</a></li><li><a href="/docs/code/1-idea-start.html" title="å¿…è¦è½¯ä»¶ç¯å¢ƒ" class="sidebar-link">å¿…è¦è½¯ä»¶ç¯å¢ƒ</a></li><li><a href="/docs/code/2-web-ui.html" title="æ„å»º IoT DC3 Web UI" class="sidebar-link">æ„å»º IoT DC3 Web UI</a></li><li><a href="/docs/code/3-quick-start.html" title="å¿«é€Ÿå¯åŠ¨" class="sidebar-link">å¿«é€Ÿå¯åŠ¨</a></li><li><a href="/docs/code/4-start.html" title="ğŸš€æœ€ä½³å®è·µ" class="sidebar-link">ğŸš€æœ€ä½³å®è·µ</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ“ä½œæ‰‹å†Œ</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>åŠŸèƒ½è¯´æ˜</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>é©±åŠ¨ä½¿ç”¨è¯´æ˜</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ç›¸å…³æ–‡æ¡£</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>é›†ç¾¤éƒ¨ç½²</span> <span class="arrow down"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/cluster/emqx.html" title="EMQ X é›†ç¾¤éƒ¨ç½²" class="sidebar-link">EMQ X é›†ç¾¤éƒ¨ç½²</a></li><li><a href="/docs/cluster/mongo.html" aria-current="page" title="Mongo é›†ç¾¤éƒ¨ç½²" class="active sidebar-link">Mongo é›†ç¾¤éƒ¨ç½²</a></li><li><a href="/docs/cluster/rabbitmq.html" title="RabbitMQ é›†ç¾¤éƒ¨ç½²" class="sidebar-link">RabbitMQ é›†ç¾¤éƒ¨ç½²</a></li><li><a href="/docs/cluster/redis.html" title="Redis é›†ç¾¤éƒ¨ç½²" class="sidebar-link">Redis é›†ç¾¤éƒ¨ç½²</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>é”™è¯¯</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><a href="/docs/update-log.html" title="æ›´æ–°æ—¥å¿—&amp;&amp;å¼€å‘è®¡åˆ’" class="sidebar-link">æ›´æ–°æ—¥å¿—&amp;&amp;å¼€å‘è®¡åˆ’</a></li><li><a href="/docs/about.html" title="å…³äºé¡¹ç›®" class="sidebar-link">å…³äºé¡¹ç›®</a></li></ul> </aside> <main class="page has-page-anchor"> <div class="theme-dc3-content content__default"><h2 id="mongo-é›†ç¾¤éƒ¨ç½²"><code>Mongo</code> é›†ç¾¤éƒ¨ç½² <a href="#mongo-é›†ç¾¤éƒ¨ç½²" class="header-anchor">#</a></h2> <h3 id="_1-é›†ç¾¤æ¶æ„">1. é›†ç¾¤æ¶æ„ <a href="#_1-é›†ç¾¤æ¶æ„" class="header-anchor">#</a></h3> <p><img src="/assets/images/dc3/cluster/mongo/mongo-1.png" alt=""></p> <blockquote><ul><li><code>mongos</code>ï¼šæä¾›è·¯ç”±æ•°æ®åº“é›†ç¾¤è¯·æ±‚çš„å…¥å£ï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½é€šè¿‡ <code>mongos</code> è¿›è¡Œåè°ƒï¼Œä¸éœ€è¦åœ¨åº”ç”¨ç¨‹åºæ·»åŠ ä¸€ä¸ªè·¯ç”±é€‰æ‹©å™¨ï¼Œ<code>mongos</code> è‡ªå·±å°±æ˜¯ä¸€ä¸ªè¯·æ±‚åˆ†å‘ä¸­å¿ƒï¼Œå®ƒè´Ÿè´£æŠŠå¯¹åº”çš„æ•°æ®è¯·æ±‚è½¬å‘åˆ°å¯¹åº”çš„ <code>shard</code> æœåŠ¡å™¨ä¸Šã€‚åœ¨ç”Ÿäº§ç¯å¢ƒé€šå¸¸æœ‰å¤š <code>mongos</code> ä½œä¸ºè¯·æ±‚çš„å…¥å£ï¼Œé˜²æ­¢å…¶ä¸­ä¸€ä¸ªæŒ‚æ‰æ‰€æœ‰çš„ <code>mongodb</code> è¯·æ±‚éƒ½æ²¡æœ‰åŠæ³•æ“ä½œã€‚</li> <li><code>config server</code>ï¼šä¸ºé…ç½®æœåŠ¡å™¨ï¼Œå­˜å‚¨æ‰€æœ‰æ•°æ®åº“å…ƒä¿¡æ¯ï¼ˆè·¯ç”±ã€åˆ†ç‰‡ï¼‰çš„é…ç½®ã€‚<code>mongos</code> æœ¬èº«æ²¡æœ‰ç‰©ç†å­˜å‚¨åˆ†ç‰‡æœåŠ¡å™¨å’Œæ•°æ®è·¯ç”±ä¿¡æ¯ï¼Œåªæ˜¯ç¼“å­˜åœ¨å†…å­˜é‡Œï¼Œé…ç½®æœåŠ¡å™¨åˆ™å®é™…å­˜å‚¨è¿™äº›æ•°æ®ã€‚<code>mongos</code> ç¬¬ä¸€æ¬¡å¯åŠ¨æˆ–è€…å…³æ‰é‡å¯å°±ä¼šä» <code>config server</code> åŠ è½½é…ç½®ä¿¡æ¯ï¼Œä»¥åå¦‚æœé…ç½®æœåŠ¡å™¨ä¿¡æ¯å˜åŒ–ä¼šé€šçŸ¥åˆ°æ‰€æœ‰çš„ <code>mongos</code> æ›´æ–°è‡ªå·±çš„çŠ¶æ€ï¼Œè¿™æ · <code>mongos</code> å°±èƒ½ç»§ç»­å‡†ç¡®è·¯ç”±ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒé€šå¸¸æœ‰å¤šä¸ª <code>config server</code> é…ç½®æœåŠ¡å™¨ï¼Œå› ä¸ºå®ƒå­˜å‚¨äº†åˆ†ç‰‡è·¯ç”±çš„å…ƒæ•°æ®ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼</li> <li>shardï¼šåˆ†ç‰‡ï¼ˆ<code>sharding</code>ï¼‰æ˜¯æŒ‡å°†æ•°æ®åº“æ‹†åˆ†ï¼Œå°†å…¶åˆ†æ•£åœ¨ä¸åŒçš„æœºå™¨ä¸Šçš„è¿‡ç¨‹ã€‚å°†æ•°æ®åˆ†æ•£åˆ°ä¸åŒçš„æœºå™¨ä¸Šï¼Œä¸éœ€è¦åŠŸèƒ½å¼ºå¤§çš„æœåŠ¡å™¨å°±å¯ä»¥å­˜å‚¨æ›´å¤šçš„æ•°æ®å’Œå¤„ç†æ›´å¤§çš„è´Ÿè½½ã€‚åŸºæœ¬æ€æƒ³å°±æ˜¯å°†é›†åˆåˆ‡æˆå°å—ï¼Œè¿™äº›å—åˆ†æ•£åˆ°è‹¥å¹²ç‰‡é‡Œï¼Œæ¯ä¸ªç‰‡åªè´Ÿè´£æ€»æ•°æ®çš„ä¸€éƒ¨åˆ†ï¼Œæœ€åé€šè¿‡ä¸€ä¸ªå‡è¡¡å™¨æ¥å¯¹å„ä¸ªåˆ†ç‰‡è¿›è¡Œå‡è¡¡ï¼ˆæ•°æ®è¿ç§»ï¼‰ï¼Œä»3.6ç‰ˆæœ¬å¼€å§‹ï¼Œæ¯ä¸ª <code>shard</code> å¿…é¡»éƒ¨ç½²ä¸ºå‰¯æœ¬é›†ï¼ˆ<code>replica set</code>ï¼‰æ¶æ„ã€‚</li></ul></blockquote> <h3 id="_2-é›†ç¾¤éƒ¨ç½²è§„åˆ’">2. é›†ç¾¤éƒ¨ç½²è§„åˆ’ <a href="#_2-é›†ç¾¤éƒ¨ç½²è§„åˆ’" class="header-anchor">#</a></h3> <table><thead><tr><th style="text-align:center;"><code>name</code></th> <th style="text-align:center;"><code>ip</code></th> <th style="text-align:center;"><code>mongos</code></th> <th style="text-align:center;"><code>config server</code></th> <th style="text-align:center;"><code>shard cluster 1</code></th> <th style="text-align:center;"><code>shard cluster 2</code></th></tr></thead> <tbody><tr><td style="text-align:center;"><code>node-01</code></td> <td style="text-align:center;">127.0.0.1</td> <td style="text-align:center;">27090</td> <td style="text-align:center;">27080</td> <td style="text-align:center;">27117</td> <td style="text-align:center;">27217</td></tr> <tr><td style="text-align:center;"><code>node-02</code></td> <td style="text-align:center;">127.0.0.1</td> <td style="text-align:center;">27091</td> <td style="text-align:center;">27081</td> <td style="text-align:center;">27118</td> <td style="text-align:center;">27218</td></tr> <tr><td style="text-align:center;"><code>node-03</code></td> <td style="text-align:center;">127.0.0.1</td> <td style="text-align:center;">27092</td> <td style="text-align:center;">27082</td> <td style="text-align:center;">27119</td> <td style="text-align:center;">27218</td></tr></tbody></table> <blockquote><p><code>config server</code> é…ç½®æœåŠ¡å™¨å»ºè®®éƒ¨ç½²ä¸ºåŒ…å«3ä¸ªæˆå‘˜çš„å‰¯æœ¬é›†æ¨¡å¼ï¼Œå‡ºäºæµ‹è¯•ç›®çš„ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªå•æˆå‘˜å‰¯æœ¬é›†ï¼›
<code>shard</code> åˆ†ç‰‡è¯·ä½¿ç”¨è‡³å°‘åŒ…å«ä¸‰ä¸ªæˆå‘˜çš„å‰¯æœ¬é›†ã€‚å‡ºäºæµ‹è¯•ç›®çš„ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªå•æˆå‘˜å‰¯æœ¬é›†ï¼›
<code>mongos</code> æ²¡æœ‰å‰¯æœ¬é›†æ¦‚å¿µï¼Œå¯ä»¥éƒ¨ç½²1ä¸ªã€2ä¸ªæˆ–å¤šä¸ªã€‚</p></blockquote> <h3 id="_3-ä¸‹è½½å®‰è£…æ–‡ä»¶">3. ä¸‹è½½å®‰è£…æ–‡ä»¶ <a href="#_3-ä¸‹è½½å®‰è£…æ–‡ä»¶" class="header-anchor">#</a></h3> <blockquote><p>ä¸‹è½½æ–‡ä»¶</p></blockquote> <ul><li><p>ä»¥ <code>Ubuntu</code> ä¸ºä¾‹ï¼š https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-ubuntu2004-5.0.5.tgz</p></li> <li><p>å…¶ä»–ç³»ç»Ÿä¸‹è½½ï¼šhttps://www.mongodb.com/try/download/community</p></li></ul> <blockquote><p>è§£å‹æ–‡ä»¶</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># è§£å‹</span>
<span class="token function">tar</span> zxvf mongodb-linux-x86_64-ubuntu2004-5.0.5.tgz
</code></pre></div><blockquote><p>æ ¡éªŒæ–‡ä»¶</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># è¿›å…¥ bin ç›®å½•ï¼Œæµ‹è¯• mongod æ˜¯å¦å¯ç”¨</span>
<span class="token builtin class-name">cd</span> bin
./mongod <span class="token parameter variable">-h</span>
</code></pre></div><h3 id="_4-é…ç½®-shard-å¤åˆ¶é›†">4. é…ç½® <code>shard</code> å¤åˆ¶é›† <a href="#_4-é…ç½®-shard-å¤åˆ¶é›†" class="header-anchor">#</a></h3> <h4 id="_4-1-åˆ›å»ºæ–‡ä»¶ç›®å½•">4.1 åˆ›å»ºæ–‡ä»¶ç›®å½• <a href="#_4-1-åˆ›å»ºæ–‡ä»¶ç›®å½•" class="header-anchor">#</a></h4> <blockquote><p>åˆ†åˆ«åˆ›å»ºä¸¤ä¸ªå¤åˆ¶é›†ï¼ˆ<code>shard-cluster</code>ï¼‰ç›®å½•ï¼Œå¤šä¸ªä»¥æ­¤ç±»æ¨ <code>shard-cluster-N</code></p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /data

<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> mongodb/dc3/shard-cluster-01 mongodb/dc3/shard-cluster-02
</code></pre></div><blockquote><p>ä¸ºæ¯ä¸ªå¤åˆ¶é›†åˆ›å»ºä¸‰ä¸ªåˆ†ç‰‡ <code>node</code> èŠ‚ç‚¹ç›®å½•ï¼Œå¤šä¸ªä»¥æ­¤ç±»æ¨ <code>node-N</code></p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> shard-cluster-N

<span class="token function">mkdir</span> node-01 node-02 node-03
</code></pre></div><blockquote><p>ä¸ºæ¯ä¸ªåˆ†ç‰‡èŠ‚ç‚¹åˆ›å»ºé…ç½®ã€æ•°æ®ã€æ—¥å¿—å’ŒKeyç›®å½•ï¼Œå…¶ä»–èŠ‚ç‚¹æ“ä½œä¸€è‡´</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> node-N

<span class="token function">mkdir</span> data etc keys logs
</code></pre></div><h4 id="_4-2-é…ç½®æ–‡ä»¶">4.2 é…ç½®æ–‡ä»¶ <a href="#_4-2-é…ç½®æ–‡ä»¶" class="header-anchor">#</a></h4> <blockquote><p>åœ¨æ¯ä¸ªåˆ†ç‰‡èŠ‚ç‚¹çš„ <code>etc</code> ä¸‹æ·»åŠ é…ç½®æ–‡ä»¶ <code>mongo.conf</code></p></blockquote> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">processManagement</span><span class="token punctuation">:</span>
    <span class="token key atrule">fork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token key atrule">systemLog</span><span class="token punctuation">:</span>
    <span class="token key atrule">destination</span><span class="token punctuation">:</span> file
    <span class="token comment"># æŒ‡å®š mongod æœåŠ¡æ—¥å¿—æ–‡ä»¶ç›®å½•ï¼Œå…¶ä»–èŠ‚ç‚¹ä»¥æ­¤ç±»æ¨</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> /data/mongodb/dc3/shard<span class="token punctuation">-</span>cluster<span class="token punctuation">-</span>01/node<span class="token punctuation">-</span>01/logs/mongodb.log
    <span class="token key atrule">logAppend</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token key atrule">storage</span><span class="token punctuation">:</span>
    <span class="token key atrule">journal</span><span class="token punctuation">:</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment"># æŒ‡å®šæ•°å­˜æ”¾çš„è·¯å¾„ï¼Œå…¶ä»–èŠ‚ç‚¹ä»¥æ­¤ç±»æ¨</span>
    <span class="token key atrule">dbPath</span><span class="token punctuation">:</span> /data/mongodb/dc3/shard<span class="token punctuation">-</span>cluster<span class="token punctuation">-</span>01/node<span class="token punctuation">-</span>01/data/
    <span class="token key atrule">directoryPerDB</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment"># é€‰æ‹©å­˜å‚¨å¼•æ“</span>
    <span class="token key atrule">engine</span><span class="token punctuation">:</span> wiredTiger
    <span class="token key atrule">wiredTiger</span><span class="token punctuation">:</span>
        <span class="token key atrule">engineConfig</span><span class="token punctuation">:</span>
            <span class="token comment"># æŒ‡å®šå­˜å‚¨å¼•æ“çš„ cache å¤§å°</span>
            <span class="token key atrule">cacheSizeGB</span><span class="token punctuation">:</span> <span class="token number">20</span>
            <span class="token key atrule">directoryForIndexes</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">collectionConfig</span><span class="token punctuation">:</span>
            <span class="token key atrule">blockCompressor</span><span class="token punctuation">:</span> snappy
        <span class="token key atrule">indexConfig</span><span class="token punctuation">:</span>
            <span class="token key atrule">prefixCompression</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token key atrule">net</span><span class="token punctuation">:</span>
    <span class="token comment"># è®¾ç½® mongod ç›‘å¬ç«¯å£</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27117</span>
    <span class="token comment"># è®¾ç½®æœ€å¤§è¿æ¥æ•°</span>
    <span class="token key atrule">maxIncomingConnections</span><span class="token punctuation">:</span> <span class="token number">10000</span>
    <span class="token key atrule">bindIpAll</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token key atrule">operationProfiling</span><span class="token punctuation">:</span>
    <span class="token comment"># è®¾ç½®æ…¢æ—¥å¿—æ—¶é—´</span>
    <span class="token key atrule">slowOpThresholdMs</span><span class="token punctuation">:</span> <span class="token number">100</span>
    <span class="token key atrule">mode</span><span class="token punctuation">:</span> slowOp

<span class="token comment"># æ˜¯å¦æ”¯æŒåˆ†ç‰‡</span>
<span class="token key atrule">sharding</span><span class="token punctuation">:</span>
    <span class="token key atrule">clusterRole</span><span class="token punctuation">:</span> shardsvr
    <span class="token key atrule">archiveMovedChunks</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token key atrule">replication</span><span class="token punctuation">:</span>
    <span class="token key atrule">oplogSizeMB</span><span class="token punctuation">:</span> <span class="token number">10240</span>
    <span class="token comment"># è¡¨ç¤ºè¿™æ˜¯ dc3_replica é›†ç¾¤çš„ç¬¬ä¸€ä¸ªåˆ†ç‰‡</span>
    <span class="token comment"># è¯¥å¤åˆ¶é›†ä¸­çš„æ‰€æœ‰ node èŠ‚ç‚¹è¿™ä¸ªåå­—è¦ä¸€æ ·</span>
    <span class="token comment"># å¦‚æœæ˜¯ç¬¬äºŒä¸ªå¤åˆ¶é›†ï¼Œè¿™é‡Œå¯ä»¥å–å dc3_replica_2</span>
    <span class="token key atrule">replSetName</span><span class="token punctuation">:</span> dc3_replica_1

<span class="token comment">#security:</span>
<span class="token comment">#    # æŒ‡å®š keyfile ä½ç½®ï¼Œå…¶ä»–èŠ‚ç‚¹ä»¥æ­¤ç±»æ¨</span>
<span class="token comment">#    keyFile: /data/mongodb/dc3/shard-cluster-01/node-01/keys/keyfile</span>
<span class="token comment">#    clusterAuthMode: keyFile</span>
<span class="token comment">#    authorization: enabled</span>
</code></pre></div><h4 id="_4-3-å¯åŠ¨">4.3 å¯åŠ¨ <a href="#_4-3-å¯åŠ¨" class="header-anchor">#</a></h4> <div class="language-bash extra-class"><pre class="language-bash"><code>/usr/local/mongodb/bin/mongod <span class="token parameter variable">-f</span> /data/mongodb/dc3/shard-cluster-01/node-01/etc/mongo.conf

/usr/local/mongodb/bin/mongod <span class="token parameter variable">-f</span> /data/mongodb/dc3/shard-cluster-01/node-02/etc/mongo.conf

/usr/local/mongodb/bin/mongod <span class="token parameter variable">-f</span> /data/mongodb/dc3/shard-cluster-01/node-03/etc/mongo.conf

/usr/local/mongodb/bin/mongod <span class="token parameter variable">-f</span> /data/mongodb/dc3/shard-cluster-02/node-01/etc/mongo.conf

/usr/local/mongodb/bin/mongod <span class="token parameter variable">-f</span> /data/mongodb/dc3/shard-cluster-02/node-02/etc/mongo.conf

/usr/local/mongodb/bin/mongod <span class="token parameter variable">-f</span> /data/mongodb/dc3/shard-cluster-02/node-03/etc/mongo.conf
</code></pre></div><h4 id="_4-4-åˆ†ç‰‡-node-èŠ‚ç‚¹é…ç½®åˆ°-shard-å¤åˆ¶é›†">4.4 åˆ†ç‰‡ <code>node</code> èŠ‚ç‚¹é…ç½®åˆ° <code>shard</code> å¤åˆ¶é›† <a href="#_4-4-åˆ†ç‰‡-node-èŠ‚ç‚¹é…ç½®åˆ°-shard-å¤åˆ¶é›†" class="header-anchor">#</a></h4> <blockquote><p>ä¸åŒ  <code>shard</code> å¤åˆ¶é›†ä¸­çš„åˆ†ç‰‡èŠ‚ç‚¹æ“ä½œä¸€è‡´</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># ç™»å½•ç¬¬ä¸€ä¸ªå¤åˆ¶é›†ä¸­ä»»æ„ä¸€ä¸ªåˆ†ç‰‡ node èŠ‚ç‚¹</span>
/usr/local/mongodb/bin/mongo <span class="token parameter variable">--port</span> <span class="token number">27117</span>

<span class="token comment"># æ‰§è¡Œä»¥ä¸‹é…ç½®ï¼Œæ³¨æ„ idã€ipã€port é…ç½®æ— è¯¯</span>
config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;dc3_replica_1&quot;</span>,
  <span class="token string">&quot;members&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
      <span class="token string">&quot;host&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;127.0.0.1:27117&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token punctuation">{</span>
      <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
      <span class="token string">&quot;host&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;127.0.0.1:27118&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token punctuation">{</span>
      <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2</span>,
      <span class="token string">&quot;host&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;127.0.0.1:27119&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

rs.initiate<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># æŸ¥çœ‹åˆ†ç‰‡é›†ä¸­çš„èŠ‚ç‚¹çŠ¶æ€</span>
rs.status<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># é€€å‡º</span>
<span class="token builtin class-name">exit</span>

---

<span class="token comment"># ç™»å½•ç¬¬äºŒä¸ªå¤åˆ¶é›†ä¸­ä»»æ„ä¸€ä¸ªåˆ†ç‰‡ node èŠ‚ç‚¹</span>
/usr/local/mongodb/bin/mongo <span class="token parameter variable">--port</span> <span class="token number">27217</span>

<span class="token comment"># æ‰§è¡Œä»¥ä¸‹é…ç½®ï¼Œæ³¨æ„ idã€ipã€port é…ç½®æ— è¯¯</span>
config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;dc3_replica_2&quot;</span>,
  <span class="token string">&quot;members&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
      <span class="token string">&quot;host&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;127.0.0.1:27217&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token punctuation">{</span>
      <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
      <span class="token string">&quot;host&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;127.0.0.1:27218&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token punctuation">{</span>
      <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2</span>,
      <span class="token string">&quot;host&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;127.0.0.1:27219&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

rs.initiate<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># æŸ¥çœ‹åˆ†ç‰‡é›†ä¸­çš„èŠ‚ç‚¹çŠ¶æ€</span>
rs.status<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_5-é…ç½®-config-server-é›†ç¾¤">5. é…ç½® <code>config server</code> é›†ç¾¤ <a href="#_5-é…ç½®-config-server-é›†ç¾¤" class="header-anchor">#</a></h3> <h4 id="_5-1-åˆ›å»ºæ–‡ä»¶ç›®å½•">5.1 åˆ›å»ºæ–‡ä»¶ç›®å½• <a href="#_5-1-åˆ›å»ºæ–‡ä»¶ç›®å½•" class="header-anchor">#</a></h4> <blockquote><p>åˆ›å»ºä¸€ä¸ªé…ç½®æœåŠ¡ï¼ˆ<code>config-cluster</code>ï¼‰ç›®å½•</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /data

<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> mongodb/dc3/config-cluster
</code></pre></div><blockquote><p>ä¸ºé…ç½®æœåŠ¡åˆ›å»ºä¸‰ä¸ª <code>node</code> èŠ‚ç‚¹ç›®å½•ï¼Œå¤šä¸ªä»¥æ­¤ç±»æ¨ <code>node-N</code></p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> mongodb/dc3/config-cluster

<span class="token function">mkdir</span> node-01 node-02 node-03
</code></pre></div><blockquote><p>ä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ›å»ºé…ç½®ã€æ•°æ®ã€æ—¥å¿—å’ŒKeyç›®å½•ï¼Œå…¶ä»–èŠ‚ç‚¹æ“ä½œä¸€è‡´</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> node-N

<span class="token function">mkdir</span> data  etc  keys  logs
</code></pre></div><h4 id="_5-2-é…ç½®æ–‡ä»¶">5.2 é…ç½®æ–‡ä»¶ <a href="#_5-2-é…ç½®æ–‡ä»¶" class="header-anchor">#</a></h4> <blockquote><p>åœ¨æ¯ä¸ªèŠ‚ç‚¹çš„ <code>etc</code> ä¸‹æ·»åŠ é…ç½®æ–‡ä»¶ <code>config.conf</code></p></blockquote> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">processManagement</span><span class="token punctuation">:</span>
    <span class="token key atrule">fork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token key atrule">systemLog</span><span class="token punctuation">:</span>
    <span class="token key atrule">destination</span><span class="token punctuation">:</span> file
    <span class="token comment"># æŒ‡å®š mongod æœåŠ¡æ—¥å¿—æ–‡ä»¶ç›®å½•ï¼Œå…¶ä»–èŠ‚ç‚¹ä»¥æ­¤ç±»æ¨</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> /data/mongodb/dc3/config<span class="token punctuation">-</span>cluster/node<span class="token punctuation">-</span>01/logs/mongodb.log
    <span class="token key atrule">logAppend</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token key atrule">storage</span><span class="token punctuation">:</span>
    <span class="token key atrule">journal</span><span class="token punctuation">:</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment"># æŒ‡å®šæ•°å­˜æ”¾çš„è·¯å¾„ï¼Œå…¶ä»–èŠ‚ç‚¹ä»¥æ­¤ç±»æ¨</span>
    <span class="token key atrule">dbPath</span><span class="token punctuation">:</span> /data/mongodb/dc3/config<span class="token punctuation">-</span>cluster/node<span class="token punctuation">-</span>01/data/
    <span class="token key atrule">directoryPerDB</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment"># é€‰æ‹©å­˜å‚¨å¼•æ“</span>
    <span class="token key atrule">engine</span><span class="token punctuation">:</span> wiredTiger
    <span class="token key atrule">wiredTiger</span><span class="token punctuation">:</span>
        <span class="token key atrule">engineConfig</span><span class="token punctuation">:</span>
            <span class="token comment"># æŒ‡å®šå­˜å‚¨å¼•æ“çš„ cache å¤§å°</span>
            <span class="token key atrule">cacheSizeGB</span><span class="token punctuation">:</span> <span class="token number">20</span>
            <span class="token key atrule">directoryForIndexes</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">collectionConfig</span><span class="token punctuation">:</span>
            <span class="token key atrule">blockCompressor</span><span class="token punctuation">:</span> snappy
        <span class="token key atrule">indexConfig</span><span class="token punctuation">:</span>
            <span class="token key atrule">prefixCompression</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token key atrule">net</span><span class="token punctuation">:</span>
    <span class="token comment"># è®¾ç½® mongod ç›‘å¬ç«¯å£</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27080</span>
    <span class="token comment"># è®¾ç½®æœ€å¤§è¿æ¥æ•°</span>
    <span class="token key atrule">maxIncomingConnections</span><span class="token punctuation">:</span> <span class="token number">10000</span>
    <span class="token key atrule">bindIpAll</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token key atrule">operationProfiling</span><span class="token punctuation">:</span>
    <span class="token comment"># è®¾ç½®æ…¢æ—¥å¿—æ—¶é—´</span>
    <span class="token key atrule">slowOpThresholdMs</span><span class="token punctuation">:</span> <span class="token number">100</span>
    <span class="token key atrule">mode</span><span class="token punctuation">:</span> slowOp

<span class="token comment"># æ˜¯å¦æ”¯æŒåˆ†ç‰‡</span>
<span class="token key atrule">sharding</span><span class="token punctuation">:</span>
    <span class="token key atrule">clusterRole</span><span class="token punctuation">:</span> configsvr
    <span class="token key atrule">archiveMovedChunks</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token key atrule">replication</span><span class="token punctuation">:</span>
    <span class="token key atrule">oplogSizeMB</span><span class="token punctuation">:</span> <span class="token number">10240</span>
    <span class="token comment"># éœ€è¦å’Œ mongos configDB é…ç½®ä¸­çš„åå­—ä¸€è‡´</span>
    <span class="token key atrule">replSetName</span><span class="token punctuation">:</span> dc3_replica

<span class="token comment">#security:</span>
<span class="token comment">#    # æŒ‡å®š keyfile ä½ç½®ï¼Œå…¶ä»–èŠ‚ç‚¹ä»¥æ­¤ç±»æ¨</span>
<span class="token comment">#    keyFile: /data/mongodb/dc3/config-cluster/node-01/keys/keyfile</span>
<span class="token comment">#    clusterAuthMode: keyFile</span>
<span class="token comment">#    authorization: enabled</span>
</code></pre></div><h4 id="_5-3-å¯åŠ¨">5.3 å¯åŠ¨ <a href="#_5-3-å¯åŠ¨" class="header-anchor">#</a></h4> <div class="language-bash extra-class"><pre class="language-bash"><code>/usr/local/mongodb/bin/mongod <span class="token parameter variable">-f</span> /data/mongodb/dc3/config-cluster/node-01/etc/config.conf

/usr/local/mongodb/bin/mongod <span class="token parameter variable">-f</span> /data/mongodb/dc3/config-cluster/node-02/etc/config.conf

/usr/local/mongodb/bin/mongod <span class="token parameter variable">-f</span> /data/mongodb/dc3/config-cluster/node-03/etc/config.conf
</code></pre></div><h4 id="_5-4-é…ç½®-node-èŠ‚ç‚¹åˆ°-config-server-æœåŠ¡">5.4 é…ç½® <code>node</code> èŠ‚ç‚¹åˆ° <code>config server</code> æœåŠ¡ <a href="#_5-4-é…ç½®-node-èŠ‚ç‚¹åˆ°-config-server-æœåŠ¡" class="header-anchor">#</a></h4> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># ç™»å½•ä»»æ„ä¸€ä¸ª node èŠ‚ç‚¹</span>
/usr/local/mongodb/bin/mongo <span class="token parameter variable">--port</span> <span class="token number">27080</span>

<span class="token comment"># æ‰§è¡Œä»¥ä¸‹é…ç½®ï¼Œæ³¨æ„ idã€ipã€port é…ç½®æ— è¯¯</span>
config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;dc3_replica&quot;</span>,
  <span class="token string">&quot;members&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
      <span class="token string">&quot;host&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;127.0.0.1:27080&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token punctuation">{</span>
      <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
      <span class="token string">&quot;host&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;127.0.0.1:27081&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token punctuation">{</span>
      <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2</span>,
      <span class="token string">&quot;host&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;127.0.0.1:27082&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

rs.initiate<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># æŸ¥çœ‹é…ç½®æœåŠ¡ä¸­èŠ‚ç‚¹çš„çŠ¶æ€</span>
rs.status<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_6-é…ç½®-mongos-æœåŠ¡">6. é…ç½® <code>mongos</code> æœåŠ¡ <a href="#_6-é…ç½®-mongos-æœåŠ¡" class="header-anchor">#</a></h3> <h4 id="_6-1-åˆ›å»ºæ–‡ä»¶ç›®å½•">6.1 åˆ›å»ºæ–‡ä»¶ç›®å½• <a href="#_6-1-åˆ›å»ºæ–‡ä»¶ç›®å½•" class="header-anchor">#</a></h4> <blockquote><p>åˆ›å»ºä¸€ä¸ªè·¯ç”±æœåŠ¡ï¼ˆ<code>mongos-cluster</code>ï¼‰ç›®å½•</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /data

<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> mongodb/dc3/mongos-cluster
</code></pre></div><blockquote><p>ä¸ºè·¯ç”±æœåŠ¡åˆ›å»ºä¸€ä¸ª <code>node</code> èŠ‚ç‚¹ç›®å½•ï¼Œå¤šä¸ªä»¥æ­¤ç±»æ¨ <code>node-N</code></p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> mongodb/dc3/mongos-cluster

<span class="token function">mkdir</span> node-01
</code></pre></div><blockquote><p>ä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ›å»ºé…ç½®ã€æ—¥å¿—å’ŒKeyç›®å½•ï¼Œå…¶ä»–èŠ‚ç‚¹æ“ä½œä¸€è‡´</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> node-N

<span class="token function">mkdir</span> etc  keys  logs
</code></pre></div><h4 id="_6-2-é…ç½®æ–‡ä»¶">6.2 é…ç½®æ–‡ä»¶ <a href="#_6-2-é…ç½®æ–‡ä»¶" class="header-anchor">#</a></h4> <blockquote><p>åœ¨æ¯ä¸ªèŠ‚ç‚¹çš„ <code>etc</code> ä¸‹æ·»åŠ é…ç½®æ–‡ä»¶ <code>mongos.conf</code></p></blockquote> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">processManagement</span><span class="token punctuation">:</span>
    <span class="token key atrule">fork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">pidFilePath</span><span class="token punctuation">:</span> /data/mongodb/dc3/mongos<span class="token punctuation">-</span>cluster/node<span class="token punctuation">-</span>03/mongos.pid

<span class="token key atrule">systemLog</span><span class="token punctuation">:</span>
    <span class="token key atrule">destination</span><span class="token punctuation">:</span> file
    <span class="token key atrule">logAppend</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> /data/mongodb/dc3/mongos<span class="token punctuation">-</span>cluster/node<span class="token punctuation">-</span>03/logs/mongos.log

<span class="token key atrule">net</span><span class="token punctuation">:</span>
    <span class="token comment"># è®¾ç½® mongod ç›‘å¬ç«¯å£</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27090</span>
    <span class="token key atrule">maxIncomingConnections</span><span class="token punctuation">:</span> <span class="token number">10000</span>
    <span class="token key atrule">bindIpAll</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token key atrule">sharding</span><span class="token punctuation">:</span>
    <span class="token comment"># è¿™é‡Œçš„çš„ dc3_replica å¿…é¡»å’Œ mongs configDB é…ç½®åç§°ä¸€è‡´</span>
    <span class="token comment"># è¿™é‡Œçš„ä¸‰ä¸ªåœ°å€ä¸º mongo-cfg é›†ç¾¤çš„åœ°å€</span>
    <span class="token key atrule">configDB</span><span class="token punctuation">:</span> dc3_replica/127.0.0.1<span class="token punctuation">:</span><span class="token number">27080</span><span class="token punctuation">,</span>127.0.0.1<span class="token punctuation">:</span><span class="token number">27081</span><span class="token punctuation">,</span>127.0.0.1<span class="token punctuation">:</span><span class="token number">27082</span>

<span class="token comment">#ä¸å¸¦è®¤è¯éœ€è¦å±è”½è¿™ä¸¤è¡Œé…ç½®</span>
<span class="token comment">#security:</span>
<span class="token comment">#    keyFile: /data/mongodb/dc3/mongos-cluster/node-03/keys/keyfile</span>
<span class="token comment">#    clusterAuthMode: keyFile</span>
<span class="token comment">#    authorization: enabled</span>
</code></pre></div><h4 id="_6-3-å¯åŠ¨">6.3 å¯åŠ¨ <a href="#_6-3-å¯åŠ¨" class="header-anchor">#</a></h4> <div class="language-bash extra-class"><pre class="language-bash"><code>/usr/local/mongodb/bin/mongos <span class="token parameter variable">-f</span> /data/mongodb/dc3/mongos-cluster/node-01/etc/mongos.conf
</code></pre></div><h4 id="_6-4-é…ç½®-shard-å¤åˆ¶é›†åˆ°-mongos-æœåŠ¡">6.4 é…ç½® <code>shard</code> å¤åˆ¶é›†åˆ° <code>mongos</code> æœåŠ¡ <a href="#_6-4-é…ç½®-shard-å¤åˆ¶é›†åˆ°-mongos-æœåŠ¡" class="header-anchor">#</a></h4> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># ç™»å½•ä»»æ„ä¸€ä¸ª node èŠ‚ç‚¹</span>
/usr/local/mongodb/bin/mongo <span class="token parameter variable">--port</span> <span class="token number">27090</span>

sh.addShard<span class="token punctuation">(</span><span class="token string">&quot;dc3_replica_1/127.0.0.1:27117,127.0.0.1:27118,127.0.0.1:27119&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sh.addShard<span class="token punctuation">(</span><span class="token string">&quot;dc3_replica_2/127.0.0.1:27217,127.0.0.1:27218,127.0.0.1:27219&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># æŸ¥çœ‹è·¯ç”±æœåŠ¡èŠ‚ç‚¹çš„çŠ¶æ€</span>
sh.status<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">2023/4/12 ä¸‹åˆ5:00:18</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/docs/cluster/emqx.html" class="prev"><i aria-label="icon: left" class="anticon anticon-left"><svg viewBox="64 64 896 896" focusable="false" data-icon="left" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path></svg></i>
                EMQ X é›†ç¾¤éƒ¨ç½²
            </a></span> <span class="next"><a href="/docs/cluster/rabbitmq.html">
                RabbitMQ é›†ç¾¤éƒ¨ç½²
                <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> <div class="page-anchor"><div class="ant-space ant-space-vertical" style="width:100%;"><div class="ant-space-item"><div class="page-anchor-offset"><div><div class="ant-anchor-wrapper" style="max-height:100vh;"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a href="#mongo-é›†ç¾¤éƒ¨ç½²" title="Mongo é›†ç¾¤éƒ¨ç½²" class="ant-anchor-link-title">Mongo é›†ç¾¤éƒ¨ç½²</a><div class="ant-anchor-link"><a href="#_1-é›†ç¾¤æ¶æ„" title="1. é›†ç¾¤æ¶æ„" class="ant-anchor-link-title">1. é›†ç¾¤æ¶æ„</a></div><div class="ant-anchor-link"><a href="#_2-é›†ç¾¤éƒ¨ç½²è§„åˆ’" title="2. é›†ç¾¤éƒ¨ç½²è§„åˆ’" class="ant-anchor-link-title">2. é›†ç¾¤éƒ¨ç½²è§„åˆ’</a></div><div class="ant-anchor-link"><a href="#_3-ä¸‹è½½å®‰è£…æ–‡ä»¶" title="3. ä¸‹è½½å®‰è£…æ–‡ä»¶" class="ant-anchor-link-title">3. ä¸‹è½½å®‰è£…æ–‡ä»¶</a></div><div class="ant-anchor-link"><a href="#_4-é…ç½®-shard-å¤åˆ¶é›†" title="4. é…ç½® shard å¤åˆ¶é›†" class="ant-anchor-link-title">4. é…ç½® shard å¤åˆ¶é›†</a></div><div class="ant-anchor-link"><a href="#_5-é…ç½®-config-server-é›†ç¾¤" title="5. é…ç½® config server é›†ç¾¤" class="ant-anchor-link-title">5. é…ç½® config server é›†ç¾¤</a></div><div class="ant-anchor-link"><a href="#_6-é…ç½®-mongos-æœåŠ¡" title="6. é…ç½® mongos æœåŠ¡" class="ant-anchor-link-title">6. é…ç½® mongos æœåŠ¡</a></div></div></div></div></div></div></div></div></div> </main> <!----></div><div class="global-ui"></div></div>
        <script src="/assets/js/app.d87ce824.js" defer></script><script src="/assets/js/2.a8b8915e.js" defer></script><script src="/assets/js/10.db658154.js" defer></script>
    </body>
</html>
